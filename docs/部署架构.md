
## 部署架构
浏览器
  ↓
Next.js（公网）
  ↓（Server Actions / API Routes）
tv/dv（ZeroTier 内网）


✅ 下载 / 静态文件 完全可以走「Next.js Server → ZeroTier → 内网服务」


✅ 方式 3（正确姿势）：流式代理下载 Next.js 只做“管道”，不存文件

浏览器
  ↓
Next.js（公网）
  ↓ stream
tv/dv（ZeroTier 内网）


// app/api/download/route.ts

``` js
// app/api/download/route.ts
import { NextRequest } from 'next/server';

export async function GET(req: NextRequest) {
  const url = new URL(req.url);
  const file = url.searchParams.get('file');

  const innerRes = await fetch(
    `http://10.147.x.x:3000/files/${file}`,
    {
      // 重要：防止 Next 缓存
      cache: 'no-store',
    }
  );

  if (!innerRes.ok) {
    return new Response('Not Found', { status: 404 });
  }

  return new Response(innerRes.body, {
    headers: {
      'Content-Type':
        innerRes.headers.get('content-type') ?? 'application/octet-stream',
      'Content-Length':
        innerRes.headers.get('content-length') ?? '',
      'Content-Disposition':
        innerRes.headers.get('content-disposition') ??
        `attachment; filename="${file}"`,
    },
  });
}


```